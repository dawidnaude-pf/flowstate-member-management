(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},2056:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2348:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},2529:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4130:(e,t,s)=>{Promise.resolve().then(s.bind(s,7431))},5208:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("ScanFace",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]])},5229:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5917:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6583:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},7431:(e,t,s)=>{"use strict";s.d(t,{default:()=>j});var a=s(5155),l=s(2115),r=s(63),n=s(1847);let i=(0,n.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),c=(0,n.A)("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),o=(0,n.A)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),d=(0,n.A)("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);var h=s(5208),u=s(2056),m=s(5917),x=s(2529),b=s(6583),p=s(2348);let f=(0,n.A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var g=s(5229),w=s(4662);function j(){let e=(0,r.useRouter)(),t=(0,l.useRef)(null),s=(0,l.useRef)(null),n=(0,l.useRef)(null),j=(0,l.useRef)(0),[y,v]=(0,l.useState)(!1),[N,C]=(0,l.useState)(!1),[A,M]=(0,l.useState)(null),[S,I]=(0,l.useState)([]),[E,P]=(0,l.useState)(null),[R,z]=(0,l.useState)(!1),[T,q]=(0,l.useState)(null),[O,H]=(0,l.useState)(null),[U,L]=(0,l.useState)(!0),[F,D]=(0,l.useState)(new Date),[J,W]=(0,l.useState)(new Set),[_,V]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=setInterval(()=>D(new Date),1e3);return()=>clearInterval(e)},[]);let B=async()=>{try{M(null);let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}}});n.current=e,t.current&&(t.current.srcObject=e,await t.current.play()),v(!0)}catch(e){console.error("Camera access error:",e),M("Could not access camera. Please allow camera permissions.")}},G=(0,l.useCallback)(()=>{n.current&&(n.current.getTracks().forEach(e=>e.stop()),n.current=null),t.current&&(t.current.srcObject=null),v(!1),I([]),cancelAnimationFrame(j.current)},[]);(0,l.useEffect)(()=>()=>{G()},[G]);let K=(0,l.useCallback)(async()=>{if(!t.current||!s.current||!y||E||R)return;let e=t.current,a=s.current;if(0===e.videoWidth||0===e.videoHeight)return;let l=Math.min(480/e.videoWidth,1);a.width=e.videoWidth*l,a.height=e.videoHeight*l;let r=a.getContext("2d");if(!r)return;r.drawImage(e,0,0,a.width,a.height);let n=a.toDataURL("image/jpeg",.6);if(!N){C(!0);try{let e=await fetch("/api/kiosk/detect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:n})}),t=await e.json();t.faces&&t.faces.length>0?I(t.faces.map(e=>({...e,checkedIn:J.has(e.memberId||"")||!1}))):I([]),t.currentClass&&V(t.currentClass)}catch(e){console.error("Detection error:",e)}C(!1)}},[y,N,E,R]);(0,l.useEffect)(()=>{let e;return!y||E||R||(e=setInterval(()=>{K()},500)),()=>{e&&clearInterval(e)}},[y,E,R,K]);let X=async(e,t)=>{if(e.memberId&&!e.checkedIn)try{let s=await fetch("/api/kiosk/checkin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:e.memberId})}),a=await s.json();a.success&&(W(t=>new Set(t).add(e.memberId)),I(t=>t.map(t=>t.id===e.id?{...t,checkedIn:!0}:t)),t&&fetch("/api/kiosk/learn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memberId:e.memberId,imageData:t})}).catch(()=>{}),U&&new Audio("/sounds/success.mp3").play().catch(()=>{}),P(a.member),setTimeout(()=>P(null),2e3))}catch(e){console.error("Check-in error:",e)}};return(0,a.jsxs)("div",{className:"fixed inset-0 bg-slate-900 flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-slate-800/50 backdrop-blur-sm z-10",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"flex items-center px-4 py-2 text-white/70 hover:text-white transition-colors",children:[(0,a.jsx)(i,{className:"w-5 h-5 mr-2"}),"Exit Kiosk"]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-white text-xl font-bold",children:"Flow State BJJ"}),(0,a.jsxs)("p",{className:"text-white/50 text-sm",children:[(0,w.GP)(F,"EEEE, MMMM d")," • ",(0,w.GP)(F,"h:mm a")]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>L(!U),className:"p-2 text-white/70 hover:text-white transition-colors",children:U?(0,a.jsx)(c,{className:"w-5 h-5"}):(0,a.jsx)(o,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},className:"p-2 text-white/70 hover:text-white transition-colors",children:(0,a.jsx)(d,{className:"w-5 h-5"})})]})]}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-4",children:y?(0,a.jsxs)("div",{className:"relative w-full max-w-4xl aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl",children:[(0,a.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover kiosk-camera"}),(0,a.jsx)("canvas",{ref:s,className:"hidden"}),(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[S.map(e=>(0,a.jsxs)("div",{className:"absolute border-4 transition-all duration-200 rounded-lg ".concat(e.checkedIn?"border-green-500 bg-green-500/20":e.isUnknown?"border-amber-400":"border-blue-400"),style:{left:"".concat((1-e.box.x-e.box.width)*100,"%"),top:"".concat(100*e.box.y,"%"),width:"".concat(100*e.box.width,"%"),height:"".concat(100*e.box.height,"%")},children:[(0,a.jsxs)("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 px-4 py-2 rounded-xl text-sm font-bold whitespace-nowrap shadow-lg ".concat(e.checkedIn?"bg-green-500 text-white":e.isUnknown?"bg-amber-500 text-white":"bg-blue-500 text-white"),children:[e.checkedIn?"✓ ":"",e.label,e.confidence&&!e.isUnknown&&(0,a.jsxs)("span",{className:"ml-2 opacity-70 text-xs",children:[Math.round(100*e.confidence),"%"]})]}),(0,a.jsxs)("div",{className:"absolute -bottom-16 left-1/2 -translate-x-1/2 pointer-events-auto flex gap-2",children:[!e.isUnknown&&!e.checkedIn&&e.memberId&&(0,a.jsxs)("button",{onClick:()=>X(e,(()=>{if(!t.current||!s.current)return;let e=t.current,a=s.current,l=a.getContext("2d");if(l)return a.width=e.videoWidth,a.height=e.videoHeight,l.drawImage(e,0,0),a.toDataURL("image/jpeg",.8)})()),className:"px-5 py-3 bg-green-500 text-white rounded-full text-sm font-bold shadow-xl flex items-center hover:bg-green-600 transition-all transform hover:scale-105",children:[(0,a.jsx)(m.A,{className:"w-5 h-5 mr-2"}),"Check In"]}),e.checkedIn&&(0,a.jsxs)("div",{className:"px-5 py-3 bg-green-600 text-white rounded-full text-sm font-bold shadow-xl flex items-center",children:[(0,a.jsx)(x.A,{className:"w-5 h-5 mr-2"}),"Checked In"]}),e.isUnknown&&(0,a.jsxs)("button",{onClick:()=>(e=>{if(t.current&&s.current){let e=t.current,a=s.current,l=a.getContext("2d");l&&(a.width=e.videoWidth,a.height=e.videoHeight,l.drawImage(e,0,0),q(a.toDataURL("image/jpeg",.8)))}H(e),z(!0)})(e.id),className:"px-5 py-3 bg-amber-500 text-white rounded-full text-sm font-bold shadow-xl flex items-center hover:bg-amber-600 transition-all transform hover:scale-105",children:[(0,a.jsx)(b.A,{className:"w-5 h-5 mr-2"}),"Add Profile"]})]})]},e.id)),0===S.length&&!E&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-8 left-8 w-20 h-20 border-l-4 border-t-4 border-white/30 rounded-tl-2xl"}),(0,a.jsx)("div",{className:"absolute top-8 right-8 w-20 h-20 border-r-4 border-t-4 border-white/30 rounded-tr-2xl"}),(0,a.jsx)("div",{className:"absolute bottom-8 left-8 w-20 h-20 border-l-4 border-b-4 border-white/30 rounded-bl-2xl"}),(0,a.jsx)("div",{className:"absolute bottom-8 right-8 w-20 h-20 border-r-4 border-b-4 border-white/30 rounded-br-2xl"}),(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-1 bg-blue-500/50 animate-scan"})]})]}),(0,a.jsx)("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2",children:(0,a.jsx)("div",{className:"glass-dark px-6 py-3 rounded-full text-white flex items-center",children:N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{className:"w-4 h-4 animate-spin mr-2"}),"Scanning..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{className:"w-4 h-4 mr-2"}),_?"Current: ".concat(_):"Ready to scan"]})})}),(0,a.jsx)("button",{onClick:G,className:"absolute top-4 right-4 p-2 bg-white/20 hover:bg-white/30 rounded-full backdrop-blur-sm transition-colors",children:(0,a.jsx)(g.A,{className:"w-5 h-5 text-white"})})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("button",{onClick:B,className:"group flex flex-col items-center p-12 bg-gradient-to-br from-slate-800 to-slate-700 rounded-3xl shadow-2xl hover:from-slate-700 hover:to-slate-600 transition-all transform hover:scale-105",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center mb-6 group-hover:bg-blue-500 transition-colors shadow-lg shadow-blue-600/30",children:(0,a.jsx)(h.A,{className:"w-12 h-12 text-white"})}),(0,a.jsx)("span",{className:"text-white text-2xl font-bold mb-2",children:"Start Kiosk"}),(0,a.jsx)("span",{className:"text-white/50",children:"Tap to begin facial recognition check-in"})]}),A&&(0,a.jsxs)("div",{className:"mt-6 px-6 py-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-400 flex items-center mx-auto max-w-md",children:[(0,a.jsx)(u.A,{className:"w-5 h-5 mr-3 flex-shrink-0"}),A]})]})}),E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-green-500/95 flex items-center justify-center z-50 animate-fade-in",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[E.profileImage?(0,a.jsx)("img",{src:E.profileImage,alt:E.firstName,className:"w-32 h-32 rounded-full mx-auto mb-6 border-4 border-white shadow-lg object-cover"}):(0,a.jsx)("div",{className:"w-32 h-32 rounded-full mx-auto mb-6 bg-green-600 flex items-center justify-center border-4 border-white",children:(0,a.jsx)(x.A,{className:"w-16 h-16"})}),(0,a.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Welcome!"}),(0,a.jsxs)("p",{className:"text-2xl text-green-100",children:[E.firstName," ",E.lastName]}),(0,a.jsxs)("div",{className:"inline-block mt-4 px-4 py-2 rounded-full text-sm font-medium ".concat({white:"bg-slate-100 text-slate-800",blue:"bg-blue-500 text-white",purple:"bg-purple-600 text-white",brown:"bg-amber-800 text-white",black:"bg-slate-900 text-white"}[E.beltRank]||"bg-slate-400"),children:[E.beltRank.charAt(0).toUpperCase()+E.beltRank.slice(1)," Belt"]}),E.className&&(0,a.jsxs)("p",{className:"mt-4 text-green-100 text-lg",children:["Checked in for: ",E.className]})]})}),R&&(0,a.jsx)(k,{image:T,onClose:()=>{z(!1),q(null),H(null)},onSuccess:e=>{z(!1),q(null),H(null),P(e),e.id&&W(t=>new Set(t).add(e.id)),setTimeout(()=>P(null),2e3)}})]})}function k(e){let{image:t,onClose:s,onSuccess:r}=e,[n,i]=(0,l.useState)(""),[c,o]=(0,l.useState)(""),[d,h]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[x,b]=(0,l.useState)(!1),f=async e=>{e.preventDefault(),b(!0);try{let e=await fetch("/api/kiosk/enroll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:n,lastName:c,email:d,phone:u,profileImage:t})}),s=await e.json();s.success&&r(s.member)}catch(e){console.error("Enrollment error:",e)}b(!1)};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in",children:(0,a.jsxs)("div",{className:"bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl",children:[(0,a.jsxs)("div",{className:"relative h-48 bg-slate-900",children:[t&&(0,a.jsx)("img",{src:t,alt:"Captured",className:"w-full h-full object-cover opacity-80"}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex flex-col justify-end p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:"New Member"}),(0,a.jsx)("p",{className:"text-white/70",children:"Create a profile for check-in"})]}),(0,a.jsx)("button",{onClick:s,className:"absolute top-4 right-4 p-2 bg-black/30 rounded-full hover:bg-black/50 transition-colors",children:(0,a.jsx)(g.A,{className:"w-5 h-5 text-white"})})]}),(0,a.jsxs)("form",{onSubmit:f,className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"First Name *"}),(0,a.jsx)("input",{type:"text",value:n,onChange:e=>i(e.target.value),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:d,onChange:e=>h(e.target.value),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone"}),(0,a.jsx)("input",{type:"tel",value:u,onChange:e=>m(e.target.value),className:"w-full p-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"flex-1 py-3 text-slate-600 font-medium hover:bg-slate-100 rounded-xl transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x||!n,className:"flex-1 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center",children:x?(0,a.jsx)(p.A,{className:"w-5 h-5 animate-spin"}):"Create & Check In"})]})]})]})})}}},e=>{e.O(0,[504,441,493,358],()=>e(e.s=4130)),_N_E=e.O()}]);